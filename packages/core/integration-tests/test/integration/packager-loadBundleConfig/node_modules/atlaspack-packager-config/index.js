// @flow strict-local

const invariant = require('assert');
const {Packager} = require('@atlaspack/plugin');

module.exports = (new Packager({
  loadBundleConfig({bundle, bundleGraph, config}) {
    config.invalidateOnBuild();
    let x = bundleGraph
      .getBundles()
      .filter(b => b.type === 'txt' && b.needsStableName)
      .map(b => b.name);
    console.log(bundle.name, x);
    return x;
  },
  async package({bundle, bundleConfig}) {
    let contents = await bundle.getMainEntry()?.getCode();
    invariant(contents != null);

    return {
      contents: `Bundles: ${bundleConfig.join(',')}. Contents: ${contents}`,
    };
  },
}) /*: Packager */);
